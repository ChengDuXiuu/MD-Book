## 概述

### TCP/IP
<font size=4 color=CD8500>TCP/IP传输协议，即``传输控制``/``网络协议``，也叫作网络通讯协议。它是在网络的使用中的最基本的通信协议。</font>
一般是指是指一个由FTP、SMTP、TCP、UDP、IP等协议构成的协议簇， 只是因为在TCP/IP协议中TCP协议和IP协议最具代表性，所以被称为TCP/IP协议。
### 分层
网络协议通常分不同层次进行开发，每一层分别负责不同的通信功能。TCP/IP是一组不同层次上的多个协议的组合。TCP/IP通常被认为是一个四层协议系统。

    ip协议保证能找到是哪台机器，tcp协议保证传的数据准确无误，http表示传递的数据是什么格式

1. 链路层： 有时也称作数据链路层或网络接口层，通常包括操作系统中的设备驱动程序和计算机中对应的网络接口卡。
2. 网络层： 有时也称作互联网层，处理分组在网络中的活动，例如分组中的选路。
3. 运输层： 主要为两台主机上的应用程序提供端到端的通信。其包含了TCP(传输控制协议)和UDP(用户数据报协议)。
    * TCP为两台主机提供高可靠性的数据通信。他所作的工作包括把应用程序交给他的数据分成合适的小块交给下面的网络层，确认接收到的分组，设置发送最后的分组超时时钟等。(传输效率低，可靠性强，用于传输可靠性要求高，数据量大的数据)
    * UDP则为应用层提供一种非常简单的服务，他只是把称做数据包的分组从一台主机发送到另一台主机，但是并不保证该数据宝能到达另一端。任何必需的可靠性必须由应用层来提供(与TCP特性恰恰相反，用于传输可靠性要求不高，数据量小的数据，如QQ聊天数据就是通过这种方式传输的)。

> TCP和UDP内部都是用IP协议最为网络层(IP协议不可靠)，TCP在不可靠的IP层上提供了一个可靠地运输层，例如采取了超市重传、发送和接受端到端的确认分组等机制来达到可靠性。
4. 应用层： 负责处理特定的应用程序细节。几乎各种不同的TCPIP实现都会提供下面这些通用的应用程序：

    * Telnet 远程登录
    * FTP 文件传输协议
    * SMTP 简单邮件传送协议
    * SNMP 简单网络管理协议
    * ...

![失效](/网络/资料/网络协议七层结构.gif)

<center>OSI网络七层模型-结构图</center>


![失效](/网络/资料/网络协议七层结构作用.gif)
<center>OSI网络七层模型-作用图1</center>

![失效](/网络/资料/网络协议七层结构作用1.png)
<center>OSI网络七层模型-作用图2</center>

#### 常见应用层协议

* FTP（File TransportProtocol，文件传输协议）是网络上两台计算机传送文件的协议，运行在 TCP 之上，是通过 Internet 将文件从一台计算机传输到另一台计算机的一种途径。

* TFTP（Trivial FileTransfer Protocol，简单文件传输协议）是用来在客户机与服务器之间进行简单文件传输的协议，提供不复杂、开销不大的文件传输服务。

* HTTP（Hypertext TransferProtocol，超文本传输协议）是用于从 WWW 服务器传输超文本到本地浏览器的传送协议。它可以使浏览器更加高效，使网络传输减少。

* SMTP（Simple Mail TransferProtocol，简单邮件传输协议）建立在 TCP 之上，是一种提供可靠且有效的电子邮件传输的协议。 SMTP 是建模在 FTP 文件传输服务上的一种邮件服务，主要用于传输系统之间的邮件信息，并提供与电子邮件有关的通知。

* DHCP（Dynamic HostConfiguration Protocol，动态主机配置协议）建立在 UDP 之上，是基于客户机/服务器模型设计的。

* Telnet（远程登录协议）是登录和仿真程序，建立在 TCP 之上，它的基本功能是允许用户登录进入远程计算机系统。

* DNS（Domain NameSystem，域名系统）在 Internet 上域名与 IP 地址之间是一一对应的，域名虽然便于人们记忆，但机器之间只能互相识别 IP 地址，它们之间的转换工作称为域名解析.

* SNMP（Simple NetworkManagement Protocol，简单网络管理协议）是为了解决 Internet上的路由器管理问题而提出的，它可以在 IP、 IPX、AppleTalk 和其他传输协议上使用。 SNMP是指一系列网络管理规范的集合，包括协议本身、数据结构的定义和一些相关概念。目前，SNMP 已成为网络管理领域中事实上的工业标准，

### 路由器的作用
为不同类型的物理网络提供链接:以太网、令牌环网、点对点的链接和FDDI(光纤分布式数据接口)等等，将多个网络实现链接从而形成全球互联网。

### 互联网的地址
互联网上的每个接口必须有一个唯一的Internet地址(ip地址)。<font size=3 color=CD8500>ip地址长32bit</font>因此有四个输入为分别对应8bit即一个字节。

![失效](/网络/资料/ip地址分类.jpg)

<font size=4>如何分辨一个IP地址是A类还是其他类呢？</font>

看IP地址首字节即可
![失效](/网络/资料/ip地址范围.jpg)

### 端口号

#### 概念
当一台电脑启动了一个可以让远程其他电脑访问的程序，那么它就要开启至少一个端口号来让外界访问。我们可以把没有开启端口号的电脑看作是一个密封的房间，密封的房间当然不可能接受外界的访问，所以当系统开启了一个可以让外界访问的程序后它自然需要在房间上开一个窗口来接受来自外界的访问，这个窗口就是端口。

>tcp和udp采用16bit的端口号(包含源端口号和目的端口号)来识别应用程序。例如：ftp服务的tcp端口号都是21、telnet服务器的tcp端口号都是23、每个tftp(简单文件传送协议)服务器的udp端口号都是69

#### 作用

那么为什么要给端口编号来区分它们呢，既然一个程序开了一个端口，那么不是外部信息都可以通过这个开启的端口来访问了吗？答案是不可以。为什么呢？<font color=CD8500>因为数据是用端口号来通知传输层协议送给哪个软件(服务)来处理的</font>，数据是没有智慧的，如果很多的程序共用一个端口来接受数据的话，那么当外界的一个数据包送来后传输层就不知道该送给哪一个软件来处理，这样势必将导致混乱。

>一个数据包从链路层传到网络成一层一层拆去包装进行解析,当主机从网络层再往上解析时发现端口关闭则会吞掉该数据包。

#### 使用规则
TCP与UDP段结构中端口地址都是16比特，可以有在0---65535范围内的端口号。对于这65536个端口号有以下的使用规定：
1. 端口号小于256的定义为常用端口，服务器一般都是通过常用端口号来识别的。任何TCP/IP实现所提供的服务都用1---1023之间的端口号，是由ICANN来管理的；端口号从1024---49151是被注册的端口，也成为“用户端口”，被IANA指定为特殊服务使用 ；
2. 客户端只需保证该端口号在本机上是惟一的就可以了。<font color=CD8500>客户端端口号因存在时间很短暂又称临时端口号，这是因为它通常只是在用户运行该客户程序时才存在，而服务器则只要主机开着的，其服务就运行</font>；
3. 大多数TCP/IP实现给临时端口号分配1024---5000之间的端口号。大于5000的端口号是为其他服务器预留的











#### OSI七层模式简单通俗理解

感谢作者gtfaww，写出了我心中所有的表达，直接拿过来用了，再次感谢原作者！(原文：https://blog.csdn.net/qq_27623337/article/details/80982931)

这个模型学了好多次，总是记不住。今天又看了一遍，发现用历史推演的角度去看问题会更有逻辑，更好记。本文不一定严谨，可能有错漏，主要是抛砖引玉，帮助记性不好的人。总体来说，OSI模型是从底层往上层发展出来的。

这个模型推出的最开始，是是因为美国人有两台机器之间进行通信的需求。

><font size=4>需求1：</font>
科学家要解决的第一个问题是，两个硬件之间怎么通信。具体就是一台发些比特流，然后另一台能收到。

于是，科学家发明了物理层：

主要定义物理设备标准，如网线的接口类型、光纤的接口类型、各种传输介质的传输速率等。它的主要作用是传输比特流(就是由1、0转化为电流强弱来进行传输，到达目的地后在转化为1、0，也就是我们常说的数模转换与模数转换)。这一层的数据叫做<font color=red>``比特``</font>。

><font size=4>需求2：
现在通过电线我能发数据流了，但是，我还希望通过无线电波，通过其它介质来传输。然后我还要保证传输过去的比特流是正确的，要有纠错功能。

于是，发明了数据链路层：

  定义了如何让格式化数据以进行传输，以及如何让控制对物理介质的访问。这一层通常还提供错误检测和纠正，以确保数据的可靠传输。
  在该层中，数据以<font color=red>``帧``</font>为单位传输。在帧中，有收信地址(Source, SRC)和送信地址(Destination, DST)，还有能够探测错误的校验序列(Frame Check Sequence)。当然，帧中最重要的最重要是所要传输的数据 (payload)。
  以太网(Ethernet)和WiFi是现在最常见的连接层协议。通过连接层协议，我们可以建立局域的以太网或者WiFi局域网，并让位于同一局域网络中的两台计算机通信。

><font size=4>需求3：
现在我能发正确的发比特流数据到另一台计算机了，但是当我发大量数据时候，可能需要好长时间，例如一个视频格式的，网络会中断好多次（事实上，即使有了物理层和数据链路层，网络还是经常中断，只是中断的时间是毫秒级别的）。

那么，我还须要保证传输大量文件时的准确性。于是，我要对发出去的数据进行封装。就像发快递一样，一个个地发。

于是，先发明了传输层（传输层在OSI模型中，是在网络层上面）

例如TCP，是用于发大量数据的，我发了1万个包出去，另一台电脑就要告诉我是否接受到了1万个包，如果缺了3个包，就告诉我是第1001，234，8888个包丢了，那我再发一次。这样，就能保证对方把这个视频完整接收了。

例如UDP，是用于发送少量数据的。我发20个包出去，一般不会丢包，所以，我不管你收到多少个。在多人互动游戏，也经常用UDP协议，因为一般都是简单的信息，而且有广播的需求。如果用TCP，效率就很低，因为它会不停地告诉主机我收到了20个包，或者我收到了18个包，再发我两个！如果同时有1万台计算机都这样做，那么用TCP反而会降低效率，还不如用UDP，主机发出去就算了，丢几个包你就卡一下，算了，下次再发包你再更新。

这一层以<font color=red>``段``</font>为数据单位 ，TCP协议是会绑定IP和端口的协议，下面会介绍IP协议。

><font size=4>需求4：
传输层只是解决了打包的问题。但是如果我有多台计算机，怎么找到我要发的那台？或者，A要给F发信息，中间要经过B，C，D,E，但是中间还有好多节点如K.J.Z.Y。我怎么选择最佳路径？这就是路由要做的事。

于是，发明了网络层。即路由器，交换价那些具有寻址功能的设备所实现的功能。这一层定义的是IP地址，通过IP地址寻址。所以产生了IP协议。这一层以<font color=red>``包``</font>为数据单位，通过路由实现不同局域网间的通信。

><font size=4>需求5：
现在我们已经保证给正确的计算机，发送正确的封装过后的信息了。但是用户级别的体验好不好？难道我每次都要调用TCP去打包，然后调用IP协议去找路由，自己去发？当然不行，所以我们要建立一个自动收发包，自动寻址的功能。

于是，发明了会话层。会话层的作用就是建立和管理应用程序之间的通信。

><font size=4>需求6：
现在我能保证应用程序自动收发包和寻址了。但是我要用Linux给window发包，两个系统语法不一致，就像安装包一样，exe是不能在linux下用的，shell在window下也是不能直接运行的。

于是需要表示层（presentation），帮我们解决不同系统之间的通信语法问题。

><font size=4>需求7：
OK，现在所有必要条件都准备好了，我们可以写个android程序，web程序去实现需求把。

###套接字
在网络上很多应用程序都是采用客户端/服务器（C/S）的模式，实现网络通信必须将两台计算机连接起来建立一个双向的通信链路，这个双向通信链路的每一端在Java的网络编程中，我们又称之为一个套接字（Socket）。
套接字（Socket）是一个抽象出来的概念代表在端上的通信链路。

Socket：
这不是一个协议，而是一个通信模型。其实它最初是伯克利加州分校软件研究所，简称BSD发明的，主要用来一台电脑的两个进程间通信，然后把它用到了两台电脑的进程间通信。所以，可以把它简单理解为进程间通信，不是什么高级的东西。主要做的事情不就是：

A发包：发请求包给某个已经绑定的端口（所以我们经常会访问这样的地址182.13.15.16:1235，1235就是端口）；收到B的允许；然后正式发送；发送完了，告诉B要断开链接；收到断开允许，马上断开，然后发送已经断开信息给B。

B收包：绑定端口和IP；然后在这个端口监听；接收到A的请求，发允许给A，并做好接收准备，主要就是清理缓存等待接收新数据；然后正式接收；接受到断开请求，允许断开；确认断开后，继续监听其它请求。

可见，Socket其实就是I/O操作。Socket并不仅限于网络通信。在网络通信中，它涵盖了网络层、传输层、会话层、表示层、应用层——其实这都不需要记，因为Socket通信时候用到了IP和端口，仅这两个就表明了它用到了网络层和传输层；而且它无视多台电脑通信的系统差别，所以它涉及了表示层；一般Socket都是基于一个应用程序的，所以会涉及到会话层和应用层。

### 端口号
通过IP地址可以连接到指定计算机，但如果想访问目标计算机中的某个应用程序，还需要指定端口号。在计算机中，不同的应用程序是通过端口号区分的。端口号是用两个字节（16位的二进制数）表示的，它的取值范围是0~65535，其中，0~1023之间的端口号用于一些知名的网络服务和应用，用户的普通应用程序需要使用1024以上的端口号，从而避免端口号被另外一个应用或服务所占用。
