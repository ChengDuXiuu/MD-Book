`引言:`

无监控、不调优



## JPS

> 必须要保证Java进程开启UserPerfData参数，如果关闭则jps命令不可使用。使用-XX:+UsePerfData开启

>  （Java process status）用以查询正在运行的Java进程，对于本地虚拟机进程来说，进程的本地虚拟机ID与操作系统的进程ID是一志的、唯一的

`语法:`

![image-20210708220726035](第二章-JVM监控及诊断工具-命令行.assets/image-20210708220726035.png)



`jps -q`

> 简略显示

![image-20210708221156470](第二章-JVM监控及诊断工具-命令行.assets/image-20210708221156470.png)



`jps -l`

> 详细显示

![image-20210708221225219](第二章-JVM监控及诊断工具-命令行.assets/image-20210708221225219.png)



`jps -m`

> 输出虚拟机进程启动时传递给主类main的参数

==jps -m > a.txt==

![image-20210708221513131](第二章-JVM监控及诊断工具-命令行.assets/image-20210708221513131.png)

![image-20210708221709899](第二章-JVM监控及诊断工具-命令行.assets/image-20210708221709899.png)

![image-20210708221736347](第二章-JVM监控及诊断工具-命令行.assets/image-20210708221736347.png)



==jps -l -m > b.txt==

![image-20210708221914466](第二章-JVM监控及诊断工具-命令行.assets/image-20210708221914466.png)

![image-20210708221902600](第二章-JVM监控及诊断工具-命令行.assets/image-20210708221902600.png)



`jps -v`

> 查看进程jvm参数

![image-20210708222113427](第二章-JVM监控及诊断工具-命令行.assets/image-20210708222113427.png)

![image-20210708222145324](第二章-JVM监控及诊断工具-命令行.assets/image-20210708222145324.png)

![image-20210708222242493](第二章-JVM监控及诊断工具-命令行.assets/image-20210708222242493.png)



## jstat

> 查看jvm统计信息，它可以显示本地或者远程虚拟机进程中的类装载、内存、垃圾收集、JIT编译等运行数据。在没有GUI图形界面，只提供了纯文本控制台环境的服务器上，它将是运行期定位虚拟机性能问题的首选工具。常用于检测垃圾回收问题以及内存泄漏问题。



`语法：`

```bash
jstat -<option> [-t] [-h<lines>] <vmid> [<interval> [<count>]]
```



**option参数**

选项option可以由以下值构成。

==类装载相关的：==

- -class：显示ClassLoader的相关信息：当前进程类的装载个数、占用空间、卸载个数、类装载所消耗的时间等

	![image-20210708223048892](第二章-JVM监控及诊断工具-命令行.assets/image-20210708223048892.png)

==垃圾回收相关的：==

- -gc：显示与GC相关的堆信息。包括Eden区、两个Survivor区、老年代、永久代等的容量、已用空间、GC时间合计等信息。
- -gccapacity：显示内容与-gc基本相同，但输出主要关注Java堆各个区域使用到的最大、最小空间。
- -gcutil：显示内容与-gc基本相同，但输出主要关注已使用空间占总空间的百分比。
- -gccause：与-gcutil功能一样，但是会额外输出导致最后一次或当前正在发生的GC产生的原因。
- -gcnew：显示新生代GC状况
- -gcnewcapacity：显示内容与-gcnew基本相同，输出主要关注使用到的最大、最小空间
- -geold：显示老年代GC状况
- -gcoldcapacity：显示内容与-gcold基本相同，输出主要关注使用到的最大、最小空间
- -gcpermcapacity：显示永久代使用到的最大、最小空间。

JIT相关的：

- -compiler：显示JIT编译器编译过的方法、耗时等信息
- -printcompilation：输出已经被JIT编译的方法



**interval参数：** 用于指定输出统计数据的周期，单位为毫秒。即：查询间隔

> 如果没有指定interval 则默认打印一次

![jstat-interval](第二章-JVM监控及诊断工具-命令行.assets/jstat-interval.gif)

**count参数：** 用于指定查询的总次数

![jstat-interval-count](第二章-JVM监控及诊断工具-命令行.assets/jstat-interval-count.gif)

**-t参数：** 可以在输出信息前加上一个Timestamp列，显示程序的总体运行时间。单位：秒

![image-20210708224313651](第二章-JVM监控及诊断工具-命令行.assets/image-20210708224313651.png)

**-h参数：** 可以在周期性数据输出时，输出多少行数据后输出一个表头信息

> 输出三行数据后打印表头

![image-20210708224444117](第二章-JVM监控及诊断工具-命令行.assets/image-20210708224444117.png)

> **补充：** jstat还可以用来判断是否出现内存泄漏。

第1步：在长时间运行的 Java 程序中，我们可以运行jstat命令连续获取多行性能数据，并取这几行数据中 OU 列（即已占用的老年代内存）的最小值。

第2步：然后，我们每隔一段较长的时间重复一次上述操作，来获得多组 OU 最小值。如果这些值呈上涨趋势，则说明该 Java 程序的老年代内存已使用量在不断上涨，这意味着无法回收的对象在不断增加，因此很有可能存在内存泄漏。
