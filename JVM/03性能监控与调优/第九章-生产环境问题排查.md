## CPU飙升



### 1、CPU飙升原因

*   Tomcat高并发项目，所有的线程收拾运行状态，消耗CPU资源

    >   Tomcat每个请求都会创建一个线程去处理，对Tomcat服务接口实现限流、熔断、降级

*   定时任务 原理就是死循环，定时任务跑批

    >   解决 ：定时任务与业务逻辑分开部署 XXL-job

*   云服务器  Redis由C语言实现，C中有个bug【根据6379端口注入挖矿程序】

    >   解决 ： Redis端口号不能够允许在外网

*   分布式锁(乐观锁重试机制)

    >   解决：自旋要有次数限制，或者自适应自旋



### 2、如何避免生产服务器CPU飙升问题

1.  对服务接口实现限流、熔断、降级。例如Tomcat线程数设置
2.  接口比较耗时的代码不要写成同步，改用mq
3.  定时任务项目一定要和业务逻辑项目分开部署
    *   比如 定时任务单独成项目，单独部署
    *   如果定时任务项目集群可以使用分布式调度框架
4.  云服务器部署不要随意开放端口号。结合nginx部署
5.  写自旋一定要控制次数，参考适应性自旋



### 3、如何排查生产环境CPU飙升问题