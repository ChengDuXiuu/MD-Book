## 概念

提高服务器高可用

![丢失](../Redis/资料/主从复制.jpg "主从复制")  



## 特性

* 主少从多
* 主写从读【从机写数据报错 】
* 读写分离
* 主从同步 【从机也可以有从机，当主机同步数据到从机时，则从机又同步到它的从机，相当于子主机】

## 作用

1. 读写分离

        master写、slave读，提高服务器的读写负载能力

2. 负载均衡

        基于主从结构，配合读写分离，有slave分担master负载，并根据需求的变化改变slave的数量，通过多个从节点分担数据读取负载，大大提高Redis服务器并发量和数据吞吐量

3. 故障恢复

        当master出现问题时，有slave提供服务，实现快速的故障恢复

4. 数据冗余

        实现数据热备份，时持久化之外的一种数据冗余方式

5. 高可用

        基于主从复制，构建哨兵模式与集群，实现Redis的高可用方案

![丢失](../Redis/资料/主从复制工作流程.jpg "主从复制工作流程")  

![丢失](../Redis/资料/主从复制详细流程.jpg "主从复制详细流程")

![丢失](../Redis/资料/主从复制-数据同步.jpg "主从复制-数据同步")

![丢失](../Redis/资料/主从复制命令.jpg "主从复制命令")

![丢失](../Redis/资料/主从复制授权访问.jpg "主从复制授权访问")


## Tips
![丢失](../Redis/资料/master注意点.jpg "master注意点")

![丢失](../Redis/资料/slave注意点.jpg "slave注意点")

## 练习 一主一从

### 1、slave连接master

![丢失](../Redis/资料/主从复制练习-连接.jpg "主从复制练习-连接")

连接成功后会在6379服务器终端以及6380服务器终端有输出内容。如下：
![丢失](../Redis/资料/6379服务器提示.jpg "6379服务器提示")
![丢失](../Redis/资料/6380服务器提示.jpg "6380服务器提示")

### 2、数据同步

在6379主服务器中存入demo string类型数据。如下图
![丢失](../Redis/资料/6379主服务器存入数据.jpg "6379主服务器存入数据")
此时6380服务器中获取并且在两个服务器终端都会提示如下内容
![丢失](../Redis/资料/6380服务器同步6379数据.jpg "6380从服务器同步6379数据")
![丢失](../Redis/资料/主从同步终端提示.jpg "主从同步终端提示")



## 练习 一主两从

### 1、环境搭建

![image-20210828164549553](第九节-主从复制.assets/image-20210828164549553.png)

> 修改对应配置文件中的端口号。
>
> * 6379 为master
> * 6380和6381为从

### 2、启动三个服务

* 启动6379

![image-20210828164923096](第九节-主从复制.assets/image-20210828164923096.png)



* 启动6380和6381

![image-20210828165102261](第九节-主从复制.assets/image-20210828165102261.png)



### 3、查看主从信息

```bash
info replication
# 默认都是master，拥有读写能力
```

![image-20210828171042260](第九节-主从复制.assets/image-20210828171042260.png)

![image-20210828171053924](第九节-主从复制.assets/image-20210828171053924.png)

![image-20210828171103568](第九节-主从复制.assets/image-20210828171103568.png)



### 4、搭建主从集群 一主两从

> 设置6380和6381设置为6379的从机。

```bash
slaveof masterIp masterPort #在6380和6381上执行命令
```

![image-20210828171434079](第九节-主从复制.assets/image-20210828171434079.png)

![image-20210828171453030](第九节-主从复制.assets/image-20210828171453030.png)

> 全量复制 ： 一旦主从关系确定，会自动把主机上已有的数据同步复制到从库
>
> 增量复制 ： master写数据会自动同步到从机
