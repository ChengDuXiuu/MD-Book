# 可以做什么？

* 记录帖子的点赞数、评论数、和点击数(观看数)   --  hash
* 记录用户的帖子ID列表（排序），以便于快速显示用户的帖子列表  --  zset
* 记录帖子的标题、摘要、作者和封面信息，用于用户列表展示  -- hash
* 记录帖子的点赞用户ID列表，评论ID列表，用于显示和去重技术  -- zset
* 缓存近期热帖内容(帖子内容空间占用大)，减少数据库压力  -- hash
* 记录帖子的相关文章ID，根据内容推荐相关帖子  --  list
* 如果帖子ID是自增的，可以使用Redis来分配帖子ID（计数器）
* 收藏集和帖子之间的关系  --  zset
* 记录热榜帖子ID列表、总磅数和分类热榜  --  zset
* 缓存用户行为历史，过滤恶意行为   --  zset、hash

> 总体来说，之前走DB没问题的在高并发下就要走Redis了，尤其是**直接展示给用户的信息，比如一些列表数据，首页信息**等等。





# 五种数据结构

> Redis所有数据类型都是key-value结构，并且都已string类型作为key，不同的数据类型区别在于value的结构。

## 1、字符串 String  --  数组

`特点：`

* 动态字符串，类似于Java中的**ArrayList**，**动态扩容（预分配冗余空间模式）**，减少内存的频繁分配，也有数组的特点，即查询很快增删慢

	> 当字符串长度小于 1 MB时，扩容都是加倍现有的空间。
	>
	> 当字符串长度大于 1 MB时，扩容每次都是增加1MB的空间。
	>
	> 字符串最大容量为512MB

* 计数

	> 当value是整数时，还可以进行【自增】、【自减】，自增自减最大范围是signed long的最大和最小值

* 字符串都是字节组成，每个字节由8个bit组成，因此字符串可以看成很多个bit组合，也是后面bitmap（位图）数据结构原理



## 2、列表 List  --  链表

`特点:`

* 类似于Java中的双向LinkedList，查询慢，增删快

* 一般用作异步队列使用，即一个线程前面将处理后的任务结构体放入Redis，一个线程后面处理任务。保证任务顺序执行

	



`慢操作`

命令**lindex**和**ltrim**时间复杂度都是**O(n)**,属于慢操作。-1为倒数第一个元素，-n为倒数第n个元素



`快速列表`

其实Redis底层结构并不是完完全全的**LinkedList**,而是一个**quicklist**结构。

> 列表元素少的情况下，使用一块连续的内存存储，这个结构称之为 **ziplist （压缩列表）**：没有前后指针占用空间
>
> 列表元素多的情况下，改为quicklist，即多个 ziplist结构使用指针串联起来。提高性能有减少空间





## 3、字典 hash -- map

`特点:`

* 类似于Java中的HashMap，由**数组+链表**实现的一个**无序字典**，也就存在hash碰撞之类的问题。

* **扩容**和**缩容**即rehash时，由于这是一个耗时操作，因此Redis采用了**渐进式rehash策略**。

	> 在Java中扩容时，新建一个数组然后进行全量复制
	>
	> 在Redis中扩容时，新建一个hash结构，在之后的指令或者定时任务重一点点拷贝，直至拷贝完毕。类似于**延时删除策略**



## 4、集合 Set -- HashSet

`特点:`

* 类似于Java中的HashSet，键值对是**无序唯一**的。

	> 相当于字典，只是**value都是null。**

* 唯一性一般用它来做**去重功能**

	



## 5、有序列表 Zset  --  sortSet

`特点:`

* 类似于Java中的SortSet和HashMap

	> 一方面使用set来保证其**唯一性**，另一方面为每个value引入一个score，代表每个value的权重，然后使用**权重进行排序**

* 一般用于排序的功能中，比如成绩、关注度、热点新闻等
* 内部是由**跳跃表数据结构**实现，原理简单理解为**层级结构**，即中国->某省->某市->某县->某镇。通过标签直接定位到某一个层级，其它层级就不需要进行遍历，也是跳跃的由来





## 总结

### 容器通用规则

> 五种数据结构中list、set、zset、hash都是容器结构：
>
> 创建时：如果没有key则先创建后操作。
>
> 删除时：如果容器中没有元素则该key也会删除。
>
> > string数据结构只能通过操作删除key来达到如上目的。



### 过期时间

> 所有的数据结构都可以设置过期时间
>
> 过期是以对象为单位的，比如hash结构，他只以key作为过期时间对象，时间一到key下面所有的field-value都会删除。
>
> **string类型的过期时间，如果使用set重新设置value则过期时间会立马消失即没有过期时间。**

