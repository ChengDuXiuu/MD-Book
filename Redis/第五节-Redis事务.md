[toc]
###是什么

解决多个客户端执行多条连续的指令被干扰、打断、插队。将一连串指令加入事务queue中最小执行单元。等待执行事务`exec`后开始执行，期间不会出现有插队现象。

开启事务

    multi ：设定十五的开启位置，此指令执行后，后续的指令均加入到事务中。

执行事务

    exec ：设定事务的结束位置，与multi成对出现、使用。

取消事务

    discard ： 终止当前事务的定义，发生在multi之后，exec之前。

### Tips

1. 事务中指令出现语法错误则该事务取消。执行exec提示事务不存在。
2. <code><font color=FF00FF>如果语法不错，但是其中有一条指令执行出现错误，则整个事务都不会回滚。正确的执行错误的报错，并且在报错指令后的指令任然执行</font></code>。


### 锁

对key加锁

    watch key1【key2...】: 在执行exec前如果key发生了变化，终止事务执行。

>> 避免多人操作同一事件。多个采购员采购同一物品，如果第一个采购员采购完成则其余采购员的采购事务将不会执行。

取消监控

    unwatch key1 【key2...】

### 分布式锁

设置公共锁

    setnx lock-key value
详情见第二节-string数据类型-分布式锁

### 分布式锁改良

假如子分布式锁中有一个客户上锁后，其所在的服务器挂掉了，锁资源一直未被释放，则会造成死锁情况。

解决方案

1、对锁设置超时

    expire lock-key second
    pexpire lock-key milliseconds
